---
layout: post
title:  "CNN卷积神经网络"
date:   2018-10-23
categories: concept
---

![](/resource/cnn/CNN_ex.png)
- - -
## 图片分类
做图片分类的时候,我们需要一个神经网络以一张图片为输入,然后输出图片对应的类型.
让我们以一辆车为例子.
![](/resource/cnn/image_classification.png)
这件事对人来说很简单,但是对一个神经网络呢?神经网络会如何处理?

### 图片是像素的集合体
从神经网络的角度图片就是一个数字的矩阵.从下图,你可以看到放大的黑白汽车的一部分.图片由很小的小方格子组成,每个方格称为一个像素.对于黑白图片,每一个像素的值在0~255之间,0代表黑色,255代表白色.
![](/resource/cnn/grayscale_image.png)
正常的彩色图片,图片上的每个像素点都由红、绿、蓝三种像素组成.你可以把这想象成红、绿、蓝三张图片叠加到一起.彩色像素被表示为三个元素的数组.例如,RGB像素值,[255,0,0]是纯红色,而[200,0,200]是紫色.从这个角度,我们可以想象一下每张图片为一个3D的矩阵,有宽、高,还有深度------颜色,黑白图片的深度为1.
![](/resource/cnn/color_image.png)
要创建一个图片分类器,我们需要一个算法,可以观察这些像素并且能够识别出图片中有一辆汽车.我们也希望这个分类器能够在不同光线条件下(晚上或白天)识别汽车,这个分类器能很好的泛化,这样他才能识别出不同环境不同角度下不同的汽车.
![](/resource/cnn/var_cars.png)
观察一下几张汽车的图片,你会发现每张图片的像素都差异很大.所以,这个分类器要做到能够识别出不同场景图片中有汽车存在.

### 数据导向的方法
因为没有明确的方法可以创建一组规则来确定一堆像素是一辆车子,我们将采用数据导向的方法:
> 1. 收集一组有汽车标签的图片
2. 训练一个模型准确预测图片类别

![](/resource/cnn/training_data.png)
在这个例子中,我们计划训练一个卷积神经网络(convolutional neural network).这个网络在训练中,会学到汽车的哪部分为关键特征,例如轮胎和车窗,并且它要足够泛化,这样才能识别不同角度不同环境下的汽车.
* * *

### 卷积神经网络
我们将使用卷积神经网络(CNN)来完成图片分类的任务.CNN能够发现并表示彩色图片空间里的特征.很多神经网络一次只关注一个输入(处理图片的时候,一个像素),但卷积神经网络可以一次接收图片中一个区域的像素,并学会寻找空间上的特征.

每个CNN都是由多个网络层构成,主要的三种网络类型为卷积层(convolutional),池化层(pooling),和全链接层(fully-connected),如下图所示.一般,你可以看到CNN由很多网络层构成,尤其是卷积层和池化层.每个层由多个节点构成,这些节点对输入数据进行相应处理.
![](/resource/cnn/CNN_ex.png)

#### 卷积层
卷积层可以理解为这个神经网络的特征 *提取器*,它被训练来寻找输入图片的空间特征.
这个网络层通过对图片使用一系列不同的图片滤镜,也即卷积核(convolutional kernels)来生成的.这些滤镜在图片上一个像素一个像素的扫描,并且生成一个差不多跟原图片一样大小的输出图片.多个卷积核会生成多个输出图片.
![](/resource/cnn/conv_layer.gif)
如果我们有四个不同的卷积核,这样就会生成四张不同的滤出图片.每个不同的滤镜会提取输入图片中不同的特征,而这些特征对最终的图片分类有帮助.例如,一个滤镜可以检测图片中物体的边缘而另一个可能可以提取色彩中独特的特征.这些滤镜,叠合到一起就是一个卷积网络层.

### 高频率通过滤镜 (High-pass Filter)
高频率通过滤镜用来检测在小范围内强度的剧烈变化.所以,高频率通过滤镜会高亮由暗变亮或由亮变暗的区域.
![](/resource/cnn/filtered_ex.png)
例如,如果我们对一张汽车图片使用高通过滤镜,我们会看到汽车的边缘被检测到,因为边缘明暗变化比较大.物体的边缘通常强度变化比较大,因此,高频率通过滤镜有时候被称为“边缘检测滤镜”.

#### 卷积核
如下图所示,这是一个3x3的卷积核,可以用来检测边缘<br>
<img style="width:auto;" src="/resource/cnn/edge_detection_filter.png">
<br>你可能已经注意到3x3矩阵中数字的总和是0.一个边缘检测滤镜所有元素的总和为0,因为它被用来计算图片临近区域的区别或变化.如果一个区域是均匀的,那么输出为0,也就是没有检测到边缘.如果卷积核的权重总和不是0,那么它计算的输入出要么变大要么变小,输出的图片会整体变亮或变暗.

#### 卷积
对一张输入图片 *F(x,y)*,使用滤镜,即使用卷积核 *K* 进行卷积运算.卷积运算符用星号 * 表示.使用卷积核对输入图片进行逐个像素的扫描,进行边缘检测后生成新的图片.
![](/resource/cnn/filter_in_action.gif)

让我们看一个具体的例子.为了方便理解像素级的运算,我将放大汽车图片.
![](/resource/cnn/zoomed_corner.png)
对黑白图片上的每个像素,我们把卷积核放上去,这样被选中的像素在卷积核的中心,并计算卷积.在下图中,我选择中心像素值为200的点作为一个例子.
![](/resource/cnn/pixel_selection.png)
计算一个完整的卷积的步骤如下:
1. 把核对应位置的值与像素值相乘.所以3x3卷积核左上角的值(0)和图片上相应位置的像素(150)相乘.
2. 把这些像素点间的乘积进行累加,得到175.这个值就是滤出图片的对应中心点(x,y)的像素值.
![](/resource/cnn/convolution_steps.gif)

对输入图片上的每个像素点进行这种运算,直到我们得到一张完成的输出图片.
